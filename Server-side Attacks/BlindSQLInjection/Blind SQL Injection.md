# SQL Injection
- Allows an attacker to interfere with the queries that an application makes to its database
- Double-dash sequence `--` is a comment indicator in SQL, so rest of the query is interpreted as a comment. Use it depending on the kind of query. Other popular one is `' OR 1=1--`
- Cheatsheet: [https://portswigger.net/web-security/sql-injection/cheat-sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet)

### Detecting SQL Injection

Having payloads for MySQL, Postgresql, Oracle and SQL Server databases:

1. Submitting single quote character `'` and looking for errors.
2. Submitting SQL-specific syntax that evaluates to the original value of the entry point, and to a different value, and looking for differences in the application responses.
3. Submitting Boolean conditions such as `OR 1=1` and `OR 1=2, and` looking for differences in the application's responses.
4. Submitting payloads designed to trigger time delays when executed, and looking for differences in the time taken to respond.
5. Submitting OAST payloads designed to trigger an out-of-band network interaction when executed within an SQL query, and monitoring for any resulting interactions.

### UNION attacks

For a `UNION` query to work, two key requirements must be met:

- The individual queries must return the same number of columns.
- The data types in each column must be compatible between the individual queries.

To find the number of columns:

- append `' ORDER BY 1--` to the query and replace 1 with 2, 3 etc till you get an error.
- append `' UNION SELECT NULL--` then `' UNION SELECT NULL,NULL--` till you get an error. `NULL` gets converted to any data type, which increases the chance of the query succeeding.

After getting the number of columns, the data type of the column can be found by injecting a string instead of `NULL` e.g. `' UNION SELECT 'a',NULL,NULL,NULL--` and keep changing the position of `'a'` to find the data type for each column. Getting string data is always preferred.

To get information on what tables and columns are present:

- Non-oracle databases
    - Find the correct table name using `'UNION SELECT table_name FROM information_schema.tables`
    - Find the correct column name using `'UNION SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name = '<table_name>'`
- Oracle database
    - Find the correct table name using `'UNION SELECT table_name FROM all_tables`
    - Find the correct column name using `'UNION SELECT column_name FROM all_tab_columns WHERE table_name = '<table_name>'`

### Blind SQL Injection

When an application is vulnerable to SQL injection, but its HTTP responses don't contain the results of the relevant SQL query or details of any database errors, its a Blind SQL Injection.

Types of blind SQL Injection:

- Triggering a 500 Response Code by using conditional responses
- Triggering a Time Delay by using a conditional response
- Using out-of-band (OAST) techniques e.g. triggering network interactions to a system under your control, make DNS queries