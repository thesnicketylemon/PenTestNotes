## Host Header Attacks
RFC for HTTP/1.1: [https://datatracker.ietf.org/doc/html/rfc2616/](https://datatracker.ietf.org/doc/html/rfc2616/)

### Detecting Host Header Attacks
Use an intercepting proxy:
1. Supply an arbitrary, unrecognized domain name via the Host header. If the target website is still accessible,
   then study what the application does with the Host header and see whether its exploitable. 
2. If the above returns an error like `Invalid Host header`, then supply a non-numeric port with the domain name. 
3. Check if the website is using some regex matching logic and change only a part of the name of the website 
   e.g. For `vulnerable-website`, try doing `Host: notvulnerable-website.com` to see 
   if there's a response
4. Check with HTTP and HTTPS
5. Send ambiguous requests since servers handle HTTP headers in different ways. Some ways are:
    1. Send duplicate Host header. If a server has a preference or overrides a Host header, it can be used to send a payload.
    2. Use an absolute URL along with the Host header. If the server accepts the absolute URL and doesn't validate the Host, 
   then the payload can be sent with the header
    3. Indent a valid header with an additional Host header to see how the server will respond
    4. Override the Host header by using other headers that the server may support like `X-Host, X-Forwarded-Server, 
   X-HTTP-Host-Override, Forwarded`
6. URLs allow a bunch of different characters and schemes. Go through [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986#section-3.2)
   and try those out.

### Exploiting Host Header vulnerability
#### Password Reset Poisoning
Password reset relies on the property that only the intended recipient has access to the URL.
1. Get a valid email and username for the website and submit a password reset request. 
2. Intercept the request and modify the Host header to point to a domain under your control. 
3. The password reset request is sent to the victim containing the reset token. When the victim clicks on the link, 
   the token is sent to the domain under your control. Now using the token, you can reset the password

### Preventing Host Header Attacks
1. Prevent using absolute URLs and avoid using the Host header altogether in server-side code.
2. If absolute URLs are necessary, require the current domain to be manually specified in a configuration file and refer to this value instead of the Host header.
3. Validate the value in the Host header properly e.g. checking it against a whitelist of permitted domains and rejecting or redirecting any requests for unrecognized hosts
4. Configure load balancer or any reverse proxies to forward requests only to a whitelist of permitted domains
5. Validate that there is no support Host override headers e.g. X-Forwarded-Host
6. Avoid hosting internal-only websites and applications on the same server as public-facing content

## General useful tips
1. Use [Regex Tester](https://regex101.com/) to test regexes against different kinds of input
2. Use MDN's [HTTP Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers) to get information on different
    headers